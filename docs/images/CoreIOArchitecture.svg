<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="782px" preserveAspectRatio="none" style="width:3195px;height:782px;" version="1.1" viewBox="0 0 3195 782" width="3195px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="371" x="1423.5" y="16.708">fujinet-nio Core / IO / Device Architecture</text><!--MD5=[5ee6a7dca514e690cf93cb1079d10a3e]
cluster fujinet::io--><rect fill="#FFFFFF" height="387" style="stroke: #000000; stroke-width: 1.5;" width="848" x="1028" y="384.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="1414" y="399.9482">fujinet::io</text><!--MD5=[c791d24d571398ba77e97ad440c64504]
cluster fujinet::io (devices & routing)--><rect fill="#FFFFFF" height="465" style="stroke: #000000; stroke-width: 1.5;" width="982" x="22" y="70.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="396" y="85.4482">fujinet::io (devices &amp; routing)</text><!--MD5=[3413786d4f00da8daacaf7114a3ad1ef]
cluster fujinet::io (channels & transports)--><rect fill="#FFFFFF" height="452" style="stroke: #000000; stroke-width: 1.5;" width="593" x="1900" y="89.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="270" x="2061.5" y="104.4482">fujinet::io (channels &amp; transports)</text><!--MD5=[e945c46d73bfdc02e280748472025922]
cluster fujinet::core--><rect fill="#FFFFFF" height="477.5" style="stroke: #000000; stroke-width: 1.5;" width="667" x="2517" y="44.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="2801.5" y="59.9482">fujinet::core</text><!--MD5=[305369a1bced44b0cf0c147b5fa71213]
class IORequest--><rect fill="#FEFECE" height="124.8281" id="IORequest" style="stroke: #A80036; stroke-width: 1.5;" width="224" x="1383" y="419.9531"/><ellipse cx="1458.75" cy="435.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1461.7188,441.5938 Q1461.1406,441.8906 1460.5,442.0313 Q1459.8594,442.1875 1459.1563,442.1875 Q1456.6563,442.1875 1455.3281,440.5469 Q1454.0156,438.8906 1454.0156,435.7656 Q1454.0156,432.6406 1455.3281,430.9844 Q1456.6563,429.3281 1459.1563,429.3281 Q1459.8594,429.3281 1460.5,429.4844 Q1461.1563,429.6406 1461.7188,429.9375 L1461.7188,432.6563 Q1461.0938,432.0781 1460.5,431.8125 Q1459.9063,431.5313 1459.2813,431.5313 Q1457.9375,431.5313 1457.25,432.6094 Q1456.5625,433.6719 1456.5625,435.7656 Q1456.5625,437.8594 1457.25,438.9375 Q1457.9375,440 1459.2813,440 Q1459.9063,440 1460.5,439.7344 Q1461.0938,439.4531 1461.7188,438.875 L1461.7188,441.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="64" x="1479.25" y="440.1074">IORequest</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1384" x2="1606" y1="451.9531" y2="451.9531"/><ellipse cx="1394" cy="462.9531" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="1403" y="466.1636">RequestID              id</text><ellipse cx="1394" cy="475.7578" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="1403" y="478.9683">DeviceID               deviceId</text><ellipse cx="1394" cy="488.5625" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="145" x="1403" y="491.7729">RequestType            type</text><ellipse cx="1394" cy="501.3672" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="1403" y="504.5776">std::uint16_t          command</text><ellipse cx="1394" cy="514.1719" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="198" x="1403" y="517.3823">std::vector&lt;std::uint32_t&gt; params</text><ellipse cx="1394" cy="526.9766" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="195" x="1403" y="530.187">std::vector&lt;std::uint8_t&gt;  payload</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1384" x2="1606" y1="536.7813" y2="536.7813"/><!--MD5=[f980f90a635386b21d8be8c9f549c9ea]
class IOResponse--><rect fill="#FEFECE" height="112.0234" id="IOResponse" style="stroke: #A80036; stroke-width: 1.5;" width="217" x="1642.5" y="426.4531"/><ellipse cx="1709.75" cy="442.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1712.7188,448.0938 Q1712.1406,448.3906 1711.5,448.5313 Q1710.8594,448.6875 1710.1563,448.6875 Q1707.6563,448.6875 1706.3281,447.0469 Q1705.0156,445.3906 1705.0156,442.2656 Q1705.0156,439.1406 1706.3281,437.4844 Q1707.6563,435.8281 1710.1563,435.8281 Q1710.8594,435.8281 1711.5,435.9844 Q1712.1563,436.1406 1712.7188,436.4375 L1712.7188,439.1563 Q1712.0938,438.5781 1711.5,438.3125 Q1710.9063,438.0313 1710.2813,438.0313 Q1708.9375,438.0313 1708.25,439.1094 Q1707.5625,440.1719 1707.5625,442.2656 Q1707.5625,444.3594 1708.25,445.4375 Q1708.9375,446.5 1710.2813,446.5 Q1710.9063,446.5 1711.5,446.2344 Q1712.0938,445.9531 1712.7188,445.375 L1712.7188,448.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="74" x="1730.25" y="446.6074">IOResponse</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1643.5" x2="1858.5" y1="458.4531" y2="458.4531"/><ellipse cx="1653.5" cy="469.4531" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="1662.5" y="472.6636">RequestID              id</text><ellipse cx="1653.5" cy="482.2578" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="1662.5" y="485.4683">DeviceID               deviceId</text><ellipse cx="1653.5" cy="495.0625" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="1662.5" y="498.2729">StatusCode             status</text><ellipse cx="1653.5" cy="507.8672" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="1662.5" y="511.0776">std::uint16_t          command</text><ellipse cx="1653.5" cy="520.6719" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="191" x="1662.5" y="523.8823">std::vector&lt;std::uint8_t&gt; payload</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1643.5" x2="1858.5" y1="530.4766" y2="530.4766"/><!--MD5=[e2d8700bfe79070c43730c7948d6f236]
class RequestType--><rect fill="#FEFECE" height="124.8281" id="RequestType" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="1438.5" y="618.4531"/><ellipse cx="1453.5" cy="634.4531" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1457.6094,640.4531 L1449.8906,640.4531 L1449.8906,628.0625 L1457.6094,628.0625 L1457.6094,630.2188 L1452.3438,630.2188 L1452.3438,632.8906 L1457.1094,632.8906 L1457.1094,635.0469 L1452.3438,635.0469 L1452.3438,638.2969 L1457.6094,638.2969 L1457.6094,640.4531 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="81" x="1467.5" y="638.6074">RequestType</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1439.5" x2="1550.5" y1="650.4531" y2="650.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="1444.5" y="664.6636">Command</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="1444.5" y="677.4683">Read</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="1444.5" y="690.2729">Write</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="30" x="1444.5" y="703.0776">Open</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="32" x="1444.5" y="715.8823">Close</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="41" x="1444.5" y="728.687">Control</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1439.5" x2="1550.5" y1="735.2813" y2="735.2813"/><!--MD5=[55c533c45a7da117f2b000cb10c78d8e]
class StatusCode--><rect fill="#FEFECE" height="150.4375" id="StatusCode" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="1586.5" y="605.9531"/><ellipse cx="1601.5" cy="621.9531" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1605.6094,627.9531 L1597.8906,627.9531 L1597.8906,615.5625 L1605.6094,615.5625 L1605.6094,617.7188 L1600.3438,617.7188 L1600.3438,620.3906 L1605.1094,620.3906 L1605.1094,622.5469 L1600.3438,622.5469 L1600.3438,625.7969 L1605.6094,625.7969 L1605.6094,627.9531 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="73" x="1615.5" y="626.1074">StatusCode</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1587.5" x2="1690.5" y1="637.9531" y2="637.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="1592.5" y="652.1636">Ok</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="1592.5" y="664.9683">DeviceNotFound</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="1592.5" y="677.7729">InvalidRequest</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="1592.5" y="690.5776">DeviceBusy</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="53" x="1592.5" y="703.3823">NotReady</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="41" x="1592.5" y="716.187">IOError</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="46" x="1592.5" y="728.9917">Timeout</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="73" x="1592.5" y="741.7964">Unsupported</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1587.5" x2="1690.5" y1="748.3906" y2="748.3906"/><!--MD5=[7dbbd70004befa22e2d6cfe4be6cb830]
class IRequestHandler--><rect fill="#FEFECE" height="60.8047" id="IRequestHandler" style="stroke: #A80036; stroke-width: 1.5;" width="304" x="1044" y="451.9531"/><ellipse cx="1139.75" cy="467.9531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1135.6719,463.7188 L1135.6719,461.5625 L1143.0625,461.5625 L1143.0625,463.7188 L1140.5938,463.7188 L1140.5938,471.7969 L1143.0625,471.7969 L1143.0625,473.9531 L1135.6719,473.9531 L1135.6719,471.7969 L1138.1406,471.7969 L1138.1406,463.7188 L1135.6719,463.7188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="104" x="1160.25" y="472.1074">IRequestHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1045" x2="1347" y1="483.9531" y2="483.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1045" x2="1347" y1="491.9531" y2="491.9531"/><ellipse cx="1055" cy="502.9531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="278" x="1064" y="506.1636">handleRequest(request: IORequest): IOResponse</text><!--MD5=[2936ad19482b5e2731d34382e9d2ab92]
class VirtualDevice--><rect fill="#FEFECE" height="73.6094" id="VirtualDevice" style="stroke: #A80036; stroke-width: 1.5;" width="258" x="337" y="445.4531"/><ellipse cx="421.25" cy="461.4531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M417.1719,457.2188 L417.1719,455.0625 L424.5625,455.0625 L424.5625,457.2188 L422.0938,457.2188 L422.0938,465.2969 L424.5625,465.2969 L424.5625,467.4531 L417.1719,467.4531 L417.1719,465.2969 L419.6406,465.2969 L419.6406,457.2188 L417.1719,457.2188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="441.75" y="465.6074">VirtualDevice</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="338" x2="594" y1="477.4531" y2="477.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="338" x2="594" y1="485.4531" y2="485.4531"/><ellipse cx="348" cy="496.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="232" x="357" y="499.6636">handle(request: IORequest): IOResponse</text><ellipse cx="348" cy="509.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="357" y="512.4683">poll(): void</text><!--MD5=[d3fbe8b14bd166c4bb0edef3793e45f7]
class IODeviceManager--><rect fill="#FEFECE" height="176.0469" id="IODeviceManager" style="stroke: #A80036; stroke-width: 1.5;" width="446" x="542" y="105.4531"/><ellipse cx="706.75" cy="121.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M709.7188,127.0938 Q709.1406,127.3906 708.5,127.5313 Q707.8594,127.6875 707.1563,127.6875 Q704.6563,127.6875 703.3281,126.0469 Q702.0156,124.3906 702.0156,121.2656 Q702.0156,118.1406 703.3281,116.4844 Q704.6563,114.8281 707.1563,114.8281 Q707.8594,114.8281 708.5,114.9844 Q709.1563,115.1406 709.7188,115.4375 L709.7188,118.1563 Q709.0938,117.5781 708.5,117.3125 Q707.9063,117.0313 707.2813,117.0313 Q705.9375,117.0313 705.25,118.1094 Q704.5625,119.1719 704.5625,121.2656 Q704.5625,123.3594 705.25,124.4375 Q705.9375,125.5 707.2813,125.5 Q707.9063,125.5 708.5,125.2344 Q709.0938,124.9531 709.7188,124.375 L709.7188,127.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="727.25" y="125.6074">IODeviceManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="543" x2="987" y1="137.4531" y2="137.4531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="550" y="145.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="420" x="562" y="151.6636">std::unordered_map&lt;DeviceID, std::unique_ptr&lt;VirtualDevice&gt;&gt; _devices</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="543" x2="987" y1="158.2578" y2="158.2578"/><ellipse cx="553" cy="169.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="106" x="562" y="172.4683">IODeviceManager()</text><ellipse cx="553" cy="182.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="301" x="562" y="185.2729">IODeviceManager(const IODeviceManager&amp;) = delete</text><ellipse cx="553" cy="194.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="261" x="562" y="198.0776">operator=(const IODeviceManager&amp;) = delete</text><ellipse cx="553" cy="207.6719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="401" x="562" y="210.8823">registerDevice(id: DeviceID, dev: std::unique_ptr&lt;VirtualDevice&gt;): bool</text><ellipse cx="553" cy="220.4766" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="202" x="562" y="223.687">unregisterDevice(id: DeviceID): bool</text><ellipse cx="553" cy="233.2813" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="216" x="562" y="236.4917">getDevice(id: DeviceID): VirtualDevice*</text><ellipse cx="553" cy="246.0859" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="286" x="562" y="249.2964">getDevice(id: DeviceID) const: const VirtualDevice*</text><ellipse cx="553" cy="258.8906" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="278" x="562" y="262.1011">handleRequest(request: IORequest): IOResponse</text><ellipse cx="553" cy="271.6953" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="562" y="274.9058">pollDevices(): void</text><!--MD5=[dfaa8be9a2154ff64ba86d18ac419781]
class RoutingManager--><rect fill="#FEFECE" height="59.207" id="RoutingManager" style="stroke: #A80036; stroke-width: 1.5;" width="175" x="331.5" y="163.9531"/><ellipse cx="364.5" cy="179.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M367.4688,185.5938 Q366.8906,185.8906 366.25,186.0313 Q365.6094,186.1875 364.9063,186.1875 Q362.4063,186.1875 361.0781,184.5469 Q359.7656,182.8906 359.7656,179.7656 Q359.7656,176.6406 361.0781,174.9844 Q362.4063,173.3281 364.9063,173.3281 Q365.6094,173.3281 366.25,173.4844 Q366.9063,173.6406 367.4688,173.9375 L367.4688,176.6563 Q366.8438,176.0781 366.25,175.8125 Q365.6563,175.5313 365.0313,175.5313 Q363.6875,175.5313 363,176.6094 Q362.3125,177.6719 362.3125,179.7656 Q362.3125,181.8594 363,182.9375 Q363.6875,184 365.0313,184 Q365.6563,184 366.25,183.7344 Q366.8438,183.4531 367.4688,182.875 L367.4688,185.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="103" x="382.5" y="184.1074">RoutingManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="332.5" x2="505.5" y1="195.9531" y2="195.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="332.5" x2="335.5" y1="210.3555" y2="210.3555"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="335.5" y="213.6636">future routing / override logic</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="502.5" x2="505.5" y1="210.3555" y2="210.3555"/><!--MD5=[41053ab7f28be41f62bb0934c2ffddf6]
class DummyDevice--><rect fill="#FEFECE" height="73.6094" id="DummyDevice" style="stroke: #A80036; stroke-width: 1.5;" width="258" x="38" y="156.4531"/><ellipse cx="119.75" cy="172.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M122.7188,178.0938 Q122.1406,178.3906 121.5,178.5313 Q120.8594,178.6875 120.1563,178.6875 Q117.6563,178.6875 116.3281,177.0469 Q115.0156,175.3906 115.0156,172.2656 Q115.0156,169.1406 116.3281,167.4844 Q117.6563,165.8281 120.1563,165.8281 Q120.8594,165.8281 121.5,165.9844 Q122.1563,166.1406 122.7188,166.4375 L122.7188,169.1563 Q122.0938,168.5781 121.5,168.3125 Q120.9063,168.0313 120.2813,168.0313 Q118.9375,168.0313 118.25,169.1094 Q117.5625,170.1719 117.5625,172.2656 Q117.5625,174.3594 118.25,175.4375 Q118.9375,176.5 120.2813,176.5 Q120.9063,176.5 121.5,176.2344 Q122.0938,175.9531 122.7188,175.375 L122.7188,178.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="140.25" y="176.6074">DummyDevice</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="295" y1="188.4531" y2="188.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="295" y1="196.4531" y2="196.4531"/><ellipse cx="49" cy="207.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="232" x="58" y="210.6636">handle(request: IORequest): IOResponse</text><ellipse cx="49" cy="220.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="58" y="223.4683">poll(): void</text><!--MD5=[1e4e6ac1845d89d680410515caa0c0ac]
class Channel--><rect fill="#FEFECE" height="86.4141" id="Channel" style="stroke: #A80036; stroke-width: 1.5;" width="212" x="2242" y="439.4531"/><ellipse cx="2318.25" cy="455.4531" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2318.3594,450.7969 L2317.2031,455.875 L2319.5313,455.875 L2318.3594,450.7969 Z M2316.875,448.5625 L2319.8594,448.5625 L2323.2188,460.9531 L2320.7656,460.9531 L2320,457.8906 L2316.7188,457.8906 L2315.9688,460.9531 L2313.5313,460.9531 L2316.875,448.5625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="51" x="2338.75" y="459.6074">Channel</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2243" x2="2453" y1="471.4531" y2="471.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2243" x2="2453" y1="479.4531" y2="479.4531"/><ellipse cx="2253" cy="490.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="2262" y="493.6636">available(): bool</text><ellipse cx="2253" cy="503.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="2262" y="506.4683">read(buffer, maxLen): std::size_t</text><ellipse cx="2253" cy="516.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="2262" y="519.2729">write(buffer, len): void</text><!--MD5=[6131c22f5e79d7d5cd8cf70c51830c5f]
class ITransport--><rect fill="#FEFECE" height="86.4141" id="ITransport" style="stroke: #A80036; stroke-width: 1.5;" width="239" x="1957.5" y="439.4531"/><ellipse cx="2040.75" cy="455.4531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2036.6719,451.2188 L2036.6719,449.0625 L2044.0625,449.0625 L2044.0625,451.2188 L2041.5938,451.2188 L2041.5938,459.2969 L2044.0625,459.2969 L2044.0625,461.4531 L2036.6719,461.4531 L2036.6719,459.2969 L2039.1406,459.2969 L2039.1406,451.2188 L2036.6719,451.2188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="64" x="2061.25" y="459.6074">ITransport</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1958.5" x2="2195.5" y1="471.4531" y2="471.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1958.5" x2="2195.5" y1="479.4531" y2="479.4531"/><ellipse cx="1968.5" cy="490.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="1977.5" y="493.6636">poll(): void</text><ellipse cx="1968.5" cy="503.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="213" x="1977.5" y="506.4683">receive(out request: IORequest): bool</text><ellipse cx="1968.5" cy="516.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="197" x="1977.5" y="519.2729">send(response: IOResponse): void</text><!--MD5=[709d1e75402d242667c37161bd768a37]
class FujiBusTransport--><rect fill="#FEFECE" height="137.6328" id="FujiBusTransport" style="stroke: #A80036; stroke-width: 1.5;" width="257" x="2219.5" y="124.4531"/><ellipse cx="2291.25" cy="140.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2294.2188,146.0938 Q2293.6406,146.3906 2293,146.5313 Q2292.3594,146.6875 2291.6563,146.6875 Q2289.1563,146.6875 2287.8281,145.0469 Q2286.5156,143.3906 2286.5156,140.2656 Q2286.5156,137.1406 2287.8281,135.4844 Q2289.1563,133.8281 2291.6563,133.8281 Q2292.3594,133.8281 2293,133.9844 Q2293.6563,134.1406 2294.2188,134.4375 L2294.2188,137.1563 Q2293.5938,136.5781 2293,136.3125 Q2292.4063,136.0313 2291.7813,136.0313 Q2290.4375,136.0313 2289.75,137.1094 Q2289.0625,138.1719 2289.0625,140.2656 Q2289.0625,142.3594 2289.75,143.4375 Q2290.4375,144.5 2291.7813,144.5 Q2292.4063,144.5 2293,144.2344 Q2293.5938,143.9531 2294.2188,143.375 L2294.2188,146.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="2311.75" y="144.6074">FujiBusTransport</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2220.5" x2="2475.5" y1="156.4531" y2="156.4531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2227.5" y="164.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="198" x="2239.5" y="170.6636">Channel&amp;                       _channel</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2227.5" y="177.2578"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="2239.5" y="183.4683">std::vector&lt;std::uint8_t&gt;      _rxBuffer</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2227.5" y="190.0625"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="231" x="2239.5" y="196.2729">RequestID                      _nextRequestId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2220.5" x2="2475.5" y1="202.8672" y2="202.8672"/><ellipse cx="2230.5" cy="213.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="213" x="2239.5" y="217.0776">FujiBusTransport(channel: Channel&amp;)</text><ellipse cx="2230.5" cy="226.6719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="2239.5" y="229.8823">poll(): void</text><ellipse cx="2230.5" cy="239.4766" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="213" x="2239.5" y="242.687">receive(out request: IORequest): bool</text><ellipse cx="2230.5" cy="252.2813" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="197" x="2239.5" y="255.4917">send(response: IOResponse): void</text><!--MD5=[e8dc6ddde93957b96919bcaa95d997eb]
class IOService--><rect fill="#FEFECE" height="112.0234" id="IOService" style="stroke: #A80036; stroke-width: 1.5;" width="268" x="1916" y="137.4531"/><ellipse cx="2017.25" cy="153.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2020.2188,159.0938 Q2019.6406,159.3906 2019,159.5313 Q2018.3594,159.6875 2017.6563,159.6875 Q2015.1563,159.6875 2013.8281,158.0469 Q2012.5156,156.3906 2012.5156,153.2656 Q2012.5156,150.1406 2013.8281,148.4844 Q2015.1563,146.8281 2017.6563,146.8281 Q2018.3594,146.8281 2019,146.9844 Q2019.6563,147.1406 2020.2188,147.4375 L2020.2188,150.1563 Q2019.5938,149.5781 2019,149.3125 Q2018.4063,149.0313 2017.7813,149.0313 Q2016.4375,149.0313 2015.75,150.1094 Q2015.0625,151.1719 2015.0625,153.2656 Q2015.0625,155.3594 2015.75,156.4375 Q2016.4375,157.5 2017.7813,157.5 Q2018.4063,157.5 2019,157.2344 Q2019.5938,156.9531 2020.2188,156.375 L2020.2188,159.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="57" x="2037.75" y="157.6074">IOService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1917" x2="2183" y1="169.4531" y2="169.4531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1924" y="177.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="188" x="1936" y="183.6636">IRequestHandler&amp;         _handler</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1924" y="190.2578"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="214" x="1936" y="196.4683">std::vector&lt;ITransport*&gt; _transports</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1917" x2="2183" y1="203.0625" y2="203.0625"/><ellipse cx="1927" cy="214.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="216" x="1936" y="217.2729">IOService(handler: IRequestHandler&amp;)</text><ellipse cx="1927" cy="226.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="242" x="1936" y="230.0776">addTransport(transport: ITransport*): void</text><ellipse cx="1927" cy="239.6719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="109" x="1936" y="242.8823">serviceOnce(): void</text><!--MD5=[ab2140d0bb38635b666ee6301a804695]
class FujinetCore--><rect fill="#FEFECE" height="227.2656" id="FujinetCore" style="stroke: #A80036; stroke-width: 1.5;" width="323" x="2685.5" y="79.9531"/><ellipse cx="2807.25" cy="95.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2810.2188,101.5938 Q2809.6406,101.8906 2809,102.0313 Q2808.3594,102.1875 2807.6563,102.1875 Q2805.1563,102.1875 2803.8281,100.5469 Q2802.5156,98.8906 2802.5156,95.7656 Q2802.5156,92.6406 2803.8281,90.9844 Q2805.1563,89.3281 2807.6563,89.3281 Q2808.3594,89.3281 2809,89.4844 Q2809.6563,89.6406 2810.2188,89.9375 L2810.2188,92.6563 Q2809.5938,92.0781 2809,91.8125 Q2808.4063,91.5313 2807.7813,91.5313 Q2806.4375,91.5313 2805.75,92.6094 Q2805.0625,93.6719 2805.0625,95.7656 Q2805.0625,97.8594 2805.75,98.9375 Q2806.4375,100 2807.7813,100 Q2808.4063,100 2809,99.7344 Q2809.5938,99.4531 2810.2188,98.875 L2810.2188,101.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="2827.75" y="100.1074">FujinetCore</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2686.5" x2="3007.5" y1="111.9531" y2="111.9531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2693.5" y="119.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="2705.5" y="126.1636">std::uint64_t        _tickCount</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2693.5" y="132.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="215" x="2705.5" y="138.9683">io::IODeviceManager  _deviceManager</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2693.5" y="145.5625"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="2705.5" y="151.7729">io::RoutingManager   _routing</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2693.5" y="158.3672"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="162" x="2705.5" y="164.5776">io::IOService        _ioService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2686.5" x2="3007.5" y1="171.1719" y2="171.1719"/><ellipse cx="2696.5" cy="182.1719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="2705.5" y="185.3823">FujinetCore()</text><ellipse cx="2696.5" cy="194.9766" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="2705.5" y="198.187">tick(): void</text><ellipse cx="2696.5" cy="207.7813" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="178" x="2705.5" y="210.9917">tick_count() const: std::uint64_t</text><ellipse cx="2696.5" cy="220.5859" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="227" x="2705.5" y="223.7964">deviceManager(): io::IODeviceManager&amp;</text><ellipse cx="2696.5" cy="233.3906" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="297" x="2705.5" y="236.6011">deviceManager() const: const io::IODeviceManager&amp;</text><ellipse cx="2696.5" cy="246.1953" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="224" x="2705.5" y="249.4058">routingManager(): io::RoutingManager&amp;</text><ellipse cx="2696.5" cy="259" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="294" x="2705.5" y="262.2104">routingManager() const: const io::RoutingManager&amp;</text><ellipse cx="2696.5" cy="271.8047" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="150" x="2705.5" y="275.0151">ioService(): io::IOService&amp;</text><ellipse cx="2696.5" cy="284.6094" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="220" x="2705.5" y="287.8198">ioService() const: const io::IOService&amp;</text><ellipse cx="2696.5" cy="297.4141" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="260" x="2705.5" y="300.6245">addTransport(transport: io::ITransport*): void</text><!--MD5=[bc8185617a257c3c3f988ec18a0e5c19]
class io_IODeviceManager--><rect fill="#FEFECE" height="48" id="io_IODeviceManager" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="2533.5" y="458.4531"/><ellipse cx="2548.5" cy="474.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2551.4688,480.0938 Q2550.8906,480.3906 2550.25,480.5313 Q2549.6094,480.6875 2548.9063,480.6875 Q2546.4063,480.6875 2545.0781,479.0469 Q2543.7656,477.3906 2543.7656,474.2656 Q2543.7656,471.1406 2545.0781,469.4844 Q2546.4063,467.8281 2548.9063,467.8281 Q2549.6094,467.8281 2550.25,467.9844 Q2550.9063,468.1406 2551.4688,468.4375 L2551.4688,471.1563 Q2550.8438,470.5781 2550.25,470.3125 Q2549.6563,470.0313 2549.0313,470.0313 Q2547.6875,470.0313 2547,471.1094 Q2546.3125,472.1719 2546.3125,474.2656 Q2546.3125,476.3594 2547,477.4375 Q2547.6875,478.5 2549.0313,478.5 Q2549.6563,478.5 2550.25,478.2344 Q2550.8438,477.9531 2551.4688,477.375 L2551.4688,480.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="125" x="2562.5" y="478.6074">io_IODeviceManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2534.5" x2="2689.5" y1="490.4531" y2="490.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2534.5" x2="2689.5" y1="498.4531" y2="498.4531"/><!--MD5=[e3a67dfbc6d94a746b0f6513d913a51e]
class io_RoutingManager--><rect fill="#FEFECE" height="48" id="io_RoutingManager" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="2726" y="458.4531"/><ellipse cx="2741" cy="474.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2743.9688,480.0938 Q2743.3906,480.3906 2742.75,480.5313 Q2742.1094,480.6875 2741.4063,480.6875 Q2738.9063,480.6875 2737.5781,479.0469 Q2736.2656,477.3906 2736.2656,474.2656 Q2736.2656,471.1406 2737.5781,469.4844 Q2738.9063,467.8281 2741.4063,467.8281 Q2742.1094,467.8281 2742.75,467.9844 Q2743.4063,468.1406 2743.9688,468.4375 L2743.9688,471.1563 Q2743.3438,470.5781 2742.75,470.3125 Q2742.1563,470.0313 2741.5313,470.0313 Q2740.1875,470.0313 2739.5,471.1094 Q2738.8125,472.1719 2738.8125,474.2656 Q2738.8125,476.3594 2739.5,477.4375 Q2740.1875,478.5 2741.5313,478.5 Q2742.1563,478.5 2742.75,478.2344 Q2743.3438,477.9531 2743.9688,477.375 L2743.9688,480.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="120" x="2755" y="478.6074">io_RoutingManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2727" x2="2877" y1="490.4531" y2="490.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2727" x2="2877" y1="498.4531" y2="498.4531"/><!--MD5=[502998db8c7543e4d6aae8bd65548e18]
class io_IOService--><rect fill="#FEFECE" height="48" id="io_IOService" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2913" y="458.4531"/><ellipse cx="2928" cy="474.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2930.9688,480.0938 Q2930.3906,480.3906 2929.75,480.5313 Q2929.1094,480.6875 2928.4063,480.6875 Q2925.9063,480.6875 2924.5781,479.0469 Q2923.2656,477.3906 2923.2656,474.2656 Q2923.2656,471.1406 2924.5781,469.4844 Q2925.9063,467.8281 2928.4063,467.8281 Q2929.1094,467.8281 2929.75,467.9844 Q2930.4063,468.1406 2930.9688,468.4375 L2930.9688,471.1563 Q2930.3438,470.5781 2929.75,470.3125 Q2929.1563,470.0313 2928.5313,470.0313 Q2927.1875,470.0313 2926.5,471.1094 Q2925.8125,472.1719 2925.8125,474.2656 Q2925.8125,476.3594 2926.5,477.4375 Q2927.1875,478.5 2928.5313,478.5 Q2929.1563,478.5 2929.75,478.2344 Q2930.3438,477.9531 2930.9688,477.375 L2930.9688,480.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="74" x="2942" y="478.6074">io_IOService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2914" x2="3018" y1="490.4531" y2="490.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2914" x2="3018" y1="498.4531" y2="498.4531"/><!--MD5=[af16f47fb665b692cdd28e84e9249505]
class io_ITransport--><rect fill="#FEFECE" height="48" id="io_ITransport" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="3054.5" y="458.4531"/><ellipse cx="3069.5" cy="474.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3072.4688,480.0938 Q3071.8906,480.3906 3071.25,480.5313 Q3070.6094,480.6875 3069.9063,480.6875 Q3067.4063,480.6875 3066.0781,479.0469 Q3064.7656,477.3906 3064.7656,474.2656 Q3064.7656,471.1406 3066.0781,469.4844 Q3067.4063,467.8281 3069.9063,467.8281 Q3070.6094,467.8281 3071.25,467.9844 Q3071.9063,468.1406 3072.4688,468.4375 L3072.4688,471.1563 Q3071.8438,470.5781 3071.25,470.3125 Q3070.6563,470.0313 3070.0313,470.0313 Q3068.6875,470.0313 3068,471.1094 Q3067.3125,472.1719 3067.3125,474.2656 Q3067.3125,476.3594 3068,477.4375 Q3068.6875,478.5 3070.0313,478.5 Q3070.6563,478.5 3071.25,478.2344 Q3071.8438,477.9531 3072.4688,477.375 L3072.4688,480.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="81" x="3083.5" y="478.6074">io_ITransport</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3055.5" x2="3166.5" y1="490.4531" y2="490.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="3055.5" x2="3166.5" y1="498.4531" y2="498.4531"/><!--MD5=[d560c539a5f30ed1157c70be026dbdff]
link IODeviceManager to IRequestHandler--><path d="M895.78,281.5331 C975.19,334.4231 1072.87,399.4631 1134.8,440.7031 " fill="none" id="IODeviceManager-&gt;IRequestHandler" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="1138.89,435.0131,1151.66,451.9231,1131.13,446.6631,1138.89,435.0131" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[4e27f1ce077c6bb4b094768a4b9e20f5]
link DummyDevice to VirtualDevice--><path d="M204.57,230.5131 C257.37,281.2031 353.78,373.7431 413.61,431.1731 " fill="none" id="DummyDevice-&gt;VirtualDevice" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="418.77,426.4131,428.35,445.3131,409.08,436.5131,418.77,426.4131" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8ae4e4bec15f4ef514d5b3d6a5e2afdf]
reverse link IODeviceManager to VirtualDevice--><path d="M664.57,290.8531 C609.2,344.0031 543.73,406.8431 503.53,445.4231 " fill="none" id="IODeviceManager&lt;-VirtualDevice" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="674.07,281.7331,666.9718,283.0041,665.4149,290.0452,672.5131,288.7742,674.07,281.7331" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="617" y="357.52">owns</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="658.5053" y="301.4359">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="485.3293" y="434.3281">0..*</text><!--MD5=[e2457f3af94a50dfeb8d9c6d266f1c36]
link FujiBusTransport to ITransport--><path d="M2283.78,262.4631 C2237.13,311.8731 2174.73,377.9531 2130.72,424.5631 " fill="none" id="FujiBusTransport-&gt;ITransport" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="2135.65,429.5331,2116.83,439.2731,2125.47,419.9231,2135.65,429.5331" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[4e46a679f33b87cb1acfaa612e05e535]
link FujiBusTransport to Channel--><path d="M2348,262.4631 C2348,315.4031 2348,387.5031 2348,434.2631 " fill="none" id="FujiBusTransport-&gt;Channel" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2348,439.2731,2352,430.2731,2348,434.2731,2344,430.2731,2348,439.2731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="2349" y="357.52">uses</text><polygon fill="#000000" points="2359.5,366.5859,2362.5,372.5859,2365.5,366.5859,2359.5,366.5859" style="stroke: #000000; stroke-width: 1.0;"/><!--MD5=[5855d91eb88533e1aa9989ce08fde76c]
link IOService to ITransport--><path d="M2055.21,249.7931 C2060.24,303.3331 2067.8,383.6131 2072.56,434.2331 " fill="none" id="IOService-&gt;ITransport" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2073.04,439.3331,2076.1725,429.9957,2072.568,434.3555,2068.2082,430.7509,2073.04,439.3331" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="2066" y="357.52">holds 0..*</text><polygon fill="#000000" points="2092,366.5859,2095,372.5859,2098,366.5859,2092,366.5859" style="stroke: #000000; stroke-width: 1.0;"/><!--MD5=[e4ff553d9e081270e971269f82d17c77]
link IOService to IRequestHandler--><path d="M1915.7,218.2731 C1774.94,245.9731 1549.21,298.2031 1366,376.9531 C1321.07,396.2631 1274,426.0531 1240.81,448.8931 " fill="none" id="IOService-&gt;IRequestHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1236.43,451.9231,1246.1082,450.0977,1240.5435,449.0808,1241.5605,443.5161,1236.43,451.9231" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#000000" points="1463,351.5195,1457,354.5195,1463,357.5195,1463,351.5195" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1469" y="357.52">routes requests to</text><!--MD5=[12121641c43befb5d8c9146c96ea1a9a]
link FujinetCore to io_IODeviceManager--><path d="M2754.8,307.0631 C2710.81,360.7831 2661.85,420.5731 2634.21,454.3331 " fill="none" id="FujinetCore-&gt;io_IODeviceManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2630.94,458.3231,2639.7457,453.9117,2634.1155,454.461,2633.5662,448.8309,2630.94,458.3231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="2730" y="357.52">owns</text><!--MD5=[06659e4a163775a690f5d79d436cc253]
link FujinetCore to io_RoutingManager--><path d="M2829.34,307.0631 C2821.02,360.1231 2811.77,419.1131 2806.45,453.0831 " fill="none" id="FujinetCore-&gt;io_RoutingManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2805.63,458.3231,2810.97,450.0476,2806.401,453.3829,2803.0657,448.814,2805.63,458.3231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="2825" y="357.52">owns</text><!--MD5=[cf1e67190200b9c7cdb72e5c3f9b35c7]
link FujinetCore to io_IOService--><path d="M2893.69,307.0631 C2915.78,360.3431 2940.35,419.5931 2954.41,453.5031 " fill="none" id="FujinetCore-&gt;io_IOService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2956.41,458.3231,2956.6559,448.4773,2954.494,453.7048,2949.2666,451.5429,2956.41,458.3231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="2918" y="357.52">owns</text><!--MD5=[0b92fff393eed14077cfe6c190b91eb3]
link FujinetCore to io_ITransport--><path d="M2971.07,307.0331 C2993.79,329.4631 3016.71,353.3831 3037,376.9531 C3058.21,401.5931 3079.34,432.1831 3093.56,453.8831 " fill="none" id="FujinetCore-&gt;io_ITransport" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3096.31,458.1031,3094.7461,448.3792,3093.5795,453.9145,3088.0443,452.748,3096.31,458.1031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="3046.5" y="350.02">via addTransport()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="3028" y="365.1528">(delegates to IOService)</text><!--MD5=[93115a7144c7fc9e6487c768ef6852f1]
link IORequest to IOResponse--><!--MD5=[de16b29d3918365c93d760c4f616adb9]
link IORequest to RequestType--><!--MD5=[93a9c347a0a8edfc4131282ab18327e7]
link RequestType to StatusCode--><!--MD5=[381f1df2f3dd0b4473901dc5c8994c3d]
@startuml CoreIOArchitecture
title fujinet-nio Core / IO / Device Architecture

skinparam packageStyle rectangle
skinparam shadowing false

package "fujinet::io" {

    class IORequest {
        + RequestID              id
        + DeviceID               deviceId
        + RequestType            type
        + std::uint16_t          command
        + std::vector<std::uint32_t> params
        + std::vector<std::uint8_t>  payload
    }

    class IOResponse {
        + RequestID              id
        + DeviceID               deviceId
        + StatusCode             status
        + std::uint16_t          command
        + std::vector<std::uint8_t> payload
    }

    enum RequestType {
        Command
        Read
        Write
        Open
        Close
        Control
    }

    enum StatusCode {
        Ok
        DeviceNotFound
        InvalidRequest
        DeviceBusy
        NotReady
        IOError
        Timeout
        Unsupported
    }

    interface IRequestHandler {
        + handleRequest(request: IORequest): IOResponse
    }
}

package "fujinet::io (devices & routing)" {

    interface VirtualDevice {
        + handle(request: IORequest): IOResponse
        + poll(): void
    }

    class IODeviceManager {
        - std::unordered_map<DeviceID, std::unique_ptr<VirtualDevice>> _devices
        - -
        + IODeviceManager()
        + IODeviceManager(const IODeviceManager&) = delete
        + operator=(const IODeviceManager&) = delete
        + registerDevice(id: DeviceID, dev: std::unique_ptr<VirtualDevice>): bool
        + unregisterDevice(id: DeviceID): bool
        + getDevice(id: DeviceID): VirtualDevice*
        + getDevice(id: DeviceID) const: const VirtualDevice*
        + handleRequest(request: IORequest): IOResponse
        + pollDevices(): void
    }

    class RoutingManager {
        .. future routing / override logic ..
    }

    class DummyDevice {
        + handle(request: IORequest): IOResponse
        + poll(): void
    }

    IODeviceManager ..|> IRequestHandler
    DummyDevice ..|> VirtualDevice
    IODeviceManager "1" o- - "0..*" VirtualDevice : owns
}

package "fujinet::io (channels & transports)" {

    abstract class Channel {
        + available(): bool
        + read(buffer, maxLen): std::size_t
        + write(buffer, len): void
    }

    interface ITransport {
        + poll(): void
        + receive(out request: IORequest): bool
        + send(response: IOResponse): void
    }

    class FujiBusTransport {
        - Channel&                       _channel
        - std::vector<std::uint8_t>      _rxBuffer
        - RequestID                      _nextRequestId
        - -
        + FujiBusTransport(channel: Channel&)
        + poll(): void
        + receive(out request: IORequest): bool
        + send(response: IOResponse): void
    }

    class IOService {
        - IRequestHandler&         _handler
        - std::vector<ITransport*> _transports
        - -
        + IOService(handler: IRequestHandler&)
        + addTransport(transport: ITransport*): void
        + serviceOnce(): void
    }

    FujiBusTransport ..|> ITransport
    FujiBusTransport - -> Channel : uses >
    IOService - -> ITransport : holds 0..* >
    IOService - -> IRequestHandler : routes requests to >
}

package "fujinet::core" {

    class FujinetCore {
        - std::uint64_t        _tickCount
        - io::IODeviceManager  _deviceManager
        - io::RoutingManager   _routing
        - io::IOService        _ioService
        - -
        + FujinetCore()
        + tick(): void
        + tick_count() const: std::uint64_t
        + deviceManager(): io::IODeviceManager&
        + deviceManager() const: const io::IODeviceManager&
        + routingManager(): io::RoutingManager&
        + routingManager() const: const io::RoutingManager&
        + ioService(): io::IOService&
        + ioService() const: const io::IOService&
        + addTransport(transport: io::ITransport*): void
    }

    FujinetCore - -> io_IODeviceManager : owns
    FujinetCore - -> io_RoutingManager  : owns
    FujinetCore - -> io_IOService       : owns
    FujinetCore - -> io_ITransport : via addTransport()\n(delegates to IOService)
}

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.17+10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>