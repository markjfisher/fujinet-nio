<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="734px" preserveAspectRatio="none" style="width:2113px;height:734px;" version="1.1" viewBox="0 0 2113 734" width="2113px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="424" x="856" y="16.708">Platform Build Profiles + Channels + Transports</text><!--MD5=[6e9d32cc4c15e88474798fd146d79d2b]
cluster fujinet::build--><rect fill="#FFFFFF" height="391.5" style="stroke: #000000; stroke-width: 1.5;" width="524" x="22" y="332.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="234" y="347.4482">fujinet::build</text><!--MD5=[30bd2be355dc0ac5eb478fdad1ef3f46]
cluster fujinet::io::core--><rect fill="#FFFFFF" height="156" style="stroke: #000000; stroke-width: 1.5;" width="228" x="1244" y="567.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="1296" y="582.9482">fujinet::io::core</text><!--MD5=[72285c13c12940afe0b164aababa6520]
cluster fujinet::platform::posix--><rect fill="#FFFFFF" height="379.5" style="stroke: #000000; stroke-width: 1.5;" width="480" x="1118" y="134.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="1267" y="149.9482">fujinet::platform::posix</text><!--MD5=[e294bf8868427a77099db6074e9c753f]
cluster fujinet::platform::esp32--><rect fill="#FFFFFF" height="366.5" style="stroke: #000000; stroke-width: 1.5;" width="480" x="1622" y="134.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="1767.5" y="149.9482">fujinet::platform::esp32</text><!--MD5=[3fa25d5b9be051af73653736bcd3d611]
cluster fujinet::io::transport--><rect fill="#FFFFFF" height="411" style="stroke: #000000; stroke-width: 1.5;" width="232" x="862" y="312.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="897" y="327.9482">fujinet::io::transport</text><!--MD5=[e945c46d73bfdc02e280748472025922]
cluster fujinet::core--><rect fill="#FFFFFF" height="169" style="stroke: #000000; stroke-width: 1.5;" width="268" x="570" y="332.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="655" y="347.4482">fujinet::core</text><!--MD5=[1337a0cce0671f1bf71893bca8a76aa6]
class Machine--><rect fill="#FEFECE" height="99.2188" id="Machine" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="291" y="386.4531"/><ellipse cx="306" cy="402.4531" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M310.1094,408.4531 L302.3906,408.4531 L302.3906,396.0625 L310.1094,396.0625 L310.1094,398.2188 L304.8438,398.2188 L304.8438,400.8906 L309.6094,400.8906 L309.6094,403.0469 L304.8438,403.0469 L304.8438,406.2969 L310.1094,406.2969 L310.1094,408.4531 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="52" x="320" y="406.6074">Machine</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="292" x2="374" y1="418.4531" y2="418.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="297" y="432.6636">Generic</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="48" x="297" y="445.4683">Atari8Bit</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="22" x="297" y="458.2729">C64</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="12" x="297" y="471.0776">...</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="292" x2="374" y1="477.6719" y2="477.6719"/><!--MD5=[3ae7fad09c2ba6ef5d51f43edcfaf5ac]
class TransportKind--><rect fill="#FEFECE" height="99.2188" id="TransportKind" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="410.5" y="386.4531"/><ellipse cx="425.5" cy="402.4531" fill="#EB937F" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M429.6094,408.4531 L421.8906,408.4531 L421.8906,396.0625 L429.6094,396.0625 L429.6094,398.2188 L424.3438,398.2188 L424.3438,400.8906 L429.1094,400.8906 L429.1094,403.0469 L424.3438,403.0469 L424.3438,406.2969 L429.6094,406.2969 L429.6094,408.4531 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="87" x="439.5" y="406.6074">TransportKind</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="411.5" x2="528.5" y1="418.4531" y2="418.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="69" x="416.5" y="432.6636">SerialDebug</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="416.5" y="445.4683">SIO</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="416.5" y="458.2729">IEC</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="12" x="416.5" y="471.0776">...</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="411.5" x2="528.5" y1="477.6719" y2="477.6719"/><!--MD5=[fdee9a35d496db69e19187274a5f0125]
class BuildProfile--><rect fill="#FEFECE" height="86.4141" id="BuildProfile" style="stroke: #A80036; stroke-width: 1.5;" width="210" x="228" y="621.9531"/><ellipse cx="294.25" cy="637.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M297.2188,643.5938 Q296.6406,643.8906 296,644.0313 Q295.3594,644.1875 294.6563,644.1875 Q292.1563,644.1875 290.8281,642.5469 Q289.5156,640.8906 289.5156,637.7656 Q289.5156,634.6406 290.8281,632.9844 Q292.1563,631.3281 294.6563,631.3281 Q295.3594,631.3281 296,631.4844 Q296.6563,631.6406 297.2188,631.9375 L297.2188,634.6563 Q296.5938,634.0781 296,633.8125 Q295.4063,633.5313 294.7813,633.5313 Q293.4375,633.5313 292.75,634.6094 Q292.0625,635.6719 292.0625,637.7656 Q292.0625,639.8594 292.75,640.9375 Q293.4375,642 294.7813,642 Q295.4063,642 296,641.7344 Q296.5938,641.4531 297.2188,640.875 L297.2188,643.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="69" x="314.75" y="642.1074">BuildProfile</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="229" x2="437" y1="653.9531" y2="653.9531"/><ellipse cx="239" cy="664.9531" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="248" y="668.1636">Machine       machine</text><ellipse cx="239" cy="677.7578" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="184" x="248" y="680.9683">TransportKind primaryTransport</text><ellipse cx="239" cy="690.5625" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="248" y="693.7729">std::string   name</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="229" x2="437" y1="700.3672" y2="700.3672"/><!--MD5=[95995f4bc215fccb608ba9872fa17355]
class CurrentProfile--><rect fill="#FEFECE" height="60.8047" id="CurrentProfile" style="stroke: #A80036; stroke-width: 1.5;" width="218" x="38" y="405.4531"/><ellipse cx="75.05" cy="421.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M78.0188,427.0938 Q77.4406,427.3906 76.8,427.5313 Q76.1594,427.6875 75.4563,427.6875 Q72.9563,427.6875 71.6281,426.0469 Q70.3156,424.3906 70.3156,421.2656 Q70.3156,418.1406 71.6281,416.4844 Q72.9563,414.8281 75.4563,414.8281 Q76.1594,414.8281 76.8,414.9844 Q77.4563,415.1406 78.0188,415.4375 L78.0188,418.1563 Q77.3938,417.5781 76.8,417.3125 Q76.2063,417.0313 75.5813,417.0313 Q74.2375,417.0313 73.55,418.1094 Q72.8625,419.1719 72.8625,421.2656 Q72.8625,423.3594 73.55,424.4375 Q74.2375,425.5 75.5813,425.5 Q76.2063,425.5 76.8,425.2344 Q77.3938,424.9531 78.0188,424.375 L78.0188,427.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="137" x="93.95" y="425.6074">current_build_profile()</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="255" y1="437.4531" y2="437.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="39" x2="255" y1="445.4531" y2="445.4531"/><ellipse cx="49" cy="456.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="192" x="58" y="459.6636">BuildProfile current_build_profile()</text><!--MD5=[1e4e6ac1845d89d680410515caa0c0ac]
class Channel--><rect fill="#FEFECE" height="86.4141" id="Channel" style="stroke: #A80036; stroke-width: 1.5;" width="196" x="1260" y="621.9531"/><ellipse cx="1328.25" cy="637.9531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1324.1719,633.7188 L1324.1719,631.5625 L1331.5625,631.5625 L1331.5625,633.7188 L1329.0938,633.7188 L1329.0938,641.7969 L1331.5625,641.7969 L1331.5625,643.9531 L1324.1719,643.9531 L1324.1719,641.7969 L1326.6406,641.7969 L1326.6406,633.7188 L1324.1719,633.7188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="51" x="1348.75" y="642.1074">Channel</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1261" x2="1455" y1="653.9531" y2="653.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1261" x2="1455" y1="661.9531" y2="661.9531"/><ellipse cx="1271" cy="672.9531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="1280" y="676.1636">available(): bool</text><ellipse cx="1271" cy="685.7578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="170" x="1280" y="688.9683">read(buf, maxLen): std::size_t</text><ellipse cx="1271" cy="698.5625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="1280" y="701.7729">write(buf, len): void</text><!--MD5=[43fa4dc3f149c8580bb24e205fff5cde]
class PtyChannel--><rect fill="#FEFECE" height="124.8281" id="PtyChannel" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1273.5" y="373.4531"/><ellipse cx="1318.75" cy="389.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1321.7188,395.0938 Q1321.1406,395.3906 1320.5,395.5313 Q1319.8594,395.6875 1319.1563,395.6875 Q1316.6563,395.6875 1315.3281,394.0469 Q1314.0156,392.3906 1314.0156,389.2656 Q1314.0156,386.1406 1315.3281,384.4844 Q1316.6563,382.8281 1319.1563,382.8281 Q1319.8594,382.8281 1320.5,382.9844 Q1321.1563,383.1406 1321.7188,383.4375 L1321.7188,386.1563 Q1321.0938,385.5781 1320.5,385.3125 Q1319.9063,385.0313 1319.2813,385.0313 Q1317.9375,385.0313 1317.25,386.1094 Q1316.5625,387.1719 1316.5625,389.2656 Q1316.5625,391.3594 1317.25,392.4375 Q1317.9375,393.5 1319.2813,393.5 Q1319.9063,393.5 1320.5,393.2344 Q1321.0938,392.9531 1321.7188,392.375 L1321.7188,395.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="70" x="1339.25" y="393.6074">PtyChannel</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1274.5" x2="1441.5" y1="405.4531" y2="405.4531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1281.5" y="413.4531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="1293.5" y="419.6636">int _masterFd</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1274.5" x2="1441.5" y1="426.2578" y2="426.2578"/><ellipse cx="1284.5" cy="437.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="143" x="1293.5" y="440.4683">PtyChannel(int masterFd)</text><ellipse cx="1284.5" cy="450.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="80" x="1293.5" y="453.2729">~PtyChannel()</text><ellipse cx="1284.5" cy="462.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="1293.5" y="466.0776">available(): bool</text><ellipse cx="1284.5" cy="475.6719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="112" x="1293.5" y="478.8823">read(...): std::size_t</text><ellipse cx="1284.5" cy="488.4766" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="79" x="1293.5" y="491.687">write(...): void</text><!--MD5=[2565ae7dfc0d0a58b7d8f1ae83d97289]
class PosixFactory--><rect fill="#FEFECE" height="60.8047" id="PosixFactory" style="stroke: #A80036; stroke-width: 1.5;" width="447" x="1134.5" y="188.9531"/><ellipse cx="1266.25" cy="204.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1269.2188,210.5938 Q1268.6406,210.8906 1268,211.0313 Q1267.3594,211.1875 1266.6563,211.1875 Q1264.1563,211.1875 1262.8281,209.5469 Q1261.5156,207.8906 1261.5156,204.7656 Q1261.5156,201.6406 1262.8281,199.9844 Q1264.1563,198.3281 1266.6563,198.3281 Q1267.3594,198.3281 1268,198.4844 Q1268.6563,198.6406 1269.2188,198.9375 L1269.2188,201.6563 Q1268.5938,201.0781 1268,200.8125 Q1267.4063,200.5313 1266.7813,200.5313 Q1265.4375,200.5313 1264.75,201.6094 Q1264.0625,202.6719 1264.0625,204.7656 Q1264.0625,206.8594 1264.75,207.9375 Q1265.4375,209 1266.7813,209 Q1267.4063,209 1268,208.7344 Q1268.5938,208.4531 1269.2188,207.875 L1269.2188,210.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="175" x="1286.75" y="209.1074">create_channel_for_profile()</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1135.5" x2="1580.5" y1="220.9531" y2="220.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1135.5" x2="1580.5" y1="228.9531" y2="228.9531"/><ellipse cx="1145.5" cy="239.9531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="421" x="1154.5" y="243.1636">std::unique_ptr&lt;Channel&gt; create_channel_for_profile(const BuildProfile&amp;)</text><!--MD5=[e2169b3000e0f06d677eecb0f2f45580]
class UsbCdcChannel--><rect fill="#FEFECE" height="99.2188" id="UsbCdcChannel" style="stroke: #A80036; stroke-width: 1.5;" width="138" x="1715" y="386.4531"/><ellipse cx="1733.6" cy="402.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1736.5688,408.0938 Q1735.9906,408.3906 1735.35,408.5313 Q1734.7094,408.6875 1734.0063,408.6875 Q1731.5063,408.6875 1730.1781,407.0469 Q1728.8656,405.3906 1728.8656,402.2656 Q1728.8656,399.1406 1730.1781,397.4844 Q1731.5063,395.8281 1734.0063,395.8281 Q1734.7094,395.8281 1735.35,395.9844 Q1736.0063,396.1406 1736.5688,396.4375 L1736.5688,399.1563 Q1735.9438,398.5781 1735.35,398.3125 Q1734.7563,398.0313 1734.1313,398.0313 Q1732.7875,398.0313 1732.1,399.1094 Q1731.4125,400.1719 1731.4125,402.2656 Q1731.4125,404.3594 1732.1,405.4375 Q1732.7875,406.5 1734.1313,406.5 Q1734.7563,406.5 1735.35,406.2344 Q1735.9438,405.9531 1736.5688,405.375 L1736.5688,408.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="98" x="1748.4" y="406.6074">UsbCdcChannel</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1716" x2="1852" y1="418.4531" y2="418.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1716" x2="1852" y1="426.4531" y2="426.4531"/><ellipse cx="1726" cy="437.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="97" x="1735" y="440.6636">UsbCdcChannel()</text><ellipse cx="1726" cy="450.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="1735" y="453.4683">available(): bool</text><ellipse cx="1726" cy="463.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="112" x="1735" y="466.2729">read(...): std::size_t</text><ellipse cx="1726" cy="475.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="79" x="1735" y="479.0776">write(...): void</text><!--MD5=[07f8db7773b4cd61033648813b93edf2]
class Esp32Factory--><rect fill="#FEFECE" height="60.8047" id="Esp32Factory" style="stroke: #A80036; stroke-width: 1.5;" width="447" x="1638.5" y="188.9531"/><ellipse cx="1770.25" cy="204.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1773.2188,210.5938 Q1772.6406,210.8906 1772,211.0313 Q1771.3594,211.1875 1770.6563,211.1875 Q1768.1563,211.1875 1766.8281,209.5469 Q1765.5156,207.8906 1765.5156,204.7656 Q1765.5156,201.6406 1766.8281,199.9844 Q1768.1563,198.3281 1770.6563,198.3281 Q1771.3594,198.3281 1772,198.4844 Q1772.6563,198.6406 1773.2188,198.9375 L1773.2188,201.6563 Q1772.5938,201.0781 1772,200.8125 Q1771.4063,200.5313 1770.7813,200.5313 Q1769.4375,200.5313 1768.75,201.6094 Q1768.0625,202.6719 1768.0625,204.7656 Q1768.0625,206.8594 1768.75,207.9375 Q1769.4375,209 1770.7813,209 Q1771.4063,209 1772,208.7344 Q1772.5938,208.4531 1773.2188,207.875 L1773.2188,210.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="175" x="1790.75" y="209.1074">create_channel_for_profile()</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1639.5" x2="2084.5" y1="220.9531" y2="220.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1639.5" x2="2084.5" y1="228.9531" y2="228.9531"/><ellipse cx="1649.5" cy="239.9531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="421" x="1658.5" y="243.1636">std::unique_ptr&lt;Channel&gt; create_channel_for_profile(const BuildProfile&amp;)</text><!--MD5=[6131c22f5e79d7d5cd8cf70c51830c5f]
class ITransport--><rect fill="#FEFECE" height="86.4141" id="ITransport" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="880.5" y="621.9531"/><ellipse cx="937.75" cy="637.9531" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M933.6719,633.7188 L933.6719,631.5625 L941.0625,631.5625 L941.0625,633.7188 L938.5938,633.7188 L938.5938,641.7969 L941.0625,641.7969 L941.0625,643.9531 L933.6719,643.9531 L933.6719,641.7969 L936.1406,641.7969 L936.1406,633.7188 L933.6719,633.7188 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="64" x="958.25" y="642.1074">ITransport</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="881.5" x2="1066.5" y1="653.9531" y2="653.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="881.5" x2="1066.5" y1="661.9531" y2="661.9531"/><ellipse cx="891.5" cy="672.9531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="900.5" y="676.1636">poll(): void</text><ellipse cx="891.5" cy="685.7578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="900.5" y="688.9683">receive(out IORequest): bool</text><ellipse cx="891.5" cy="698.5625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="900.5" y="701.7729">send(IOResponse): void</text><!--MD5=[709d1e75402d242667c37161bd768a37]
class FujiBusTransport--><rect fill="#FEFECE" height="137.6328" id="FujiBusTransport" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="878.5" y="366.9531"/><ellipse cx="921.4" cy="382.9531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M924.3688,388.5938 Q923.7906,388.8906 923.15,389.0313 Q922.5094,389.1875 921.8063,389.1875 Q919.3063,389.1875 917.9781,387.5469 Q916.6656,385.8906 916.6656,382.7656 Q916.6656,379.6406 917.9781,377.9844 Q919.3063,376.3281 921.8063,376.3281 Q922.5094,376.3281 923.15,376.4844 Q923.8063,376.6406 924.3688,376.9375 L924.3688,379.6563 Q923.7438,379.0781 923.15,378.8125 Q922.5563,378.5313 921.9313,378.5313 Q920.5875,378.5313 919.9,379.6094 Q919.2125,380.6719 919.2125,382.7656 Q919.2125,384.8594 919.9,385.9375 Q920.5875,387 921.9313,387 Q922.5563,387 923.15,386.7344 Q923.7438,386.4531 924.3688,385.875 L924.3688,388.5938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="941.6" y="387.1074">FujiBusTransport</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="879.5" x2="1076.5" y1="398.9531" y2="398.9531"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="886.5" y="406.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="898.5" y="413.1636">Channel&amp; _channel</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="886.5" y="419.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="173" x="898.5" y="425.9683">std::vector&lt;uint8_t&gt; _rxBuffer</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="886.5" y="432.5625"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="147" x="898.5" y="438.7729">RequestID _nextRequestId</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="879.5" x2="1076.5" y1="445.3672" y2="445.3672"/><ellipse cx="889.5" cy="456.3672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="898.5" y="459.5776">FujiBusTransport(Channel&amp;)</text><ellipse cx="889.5" cy="469.1719" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="898.5" y="472.3823">poll(): void</text><ellipse cx="889.5" cy="481.9766" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="898.5" y="485.187">receive(out IORequest): bool</text><ellipse cx="889.5" cy="494.7813" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="898.5" y="497.9917">send(IOResponse): void</text><!--MD5=[ab2140d0bb38635b666ee6301a804695]
class FujinetCore--><rect fill="#FEFECE" height="99.2188" id="FujinetCore" style="stroke: #A80036; stroke-width: 1.5;" width="235" x="586.5" y="386.4531"/><ellipse cx="664.25" cy="402.4531" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667.2188,408.0938 Q666.6406,408.3906 666,408.5313 Q665.3594,408.6875 664.6563,408.6875 Q662.1563,408.6875 660.8281,407.0469 Q659.5156,405.3906 659.5156,402.2656 Q659.5156,399.1406 660.8281,397.4844 Q662.1563,395.8281 664.6563,395.8281 Q665.3594,395.8281 666,395.9844 Q666.6563,396.1406 667.2188,396.4375 L667.2188,399.1563 Q666.5938,398.5781 666,398.3125 Q665.4063,398.0313 664.7813,398.0313 Q663.4375,398.0313 662.75,399.1094 Q662.0625,400.1719 662.0625,402.2656 Q662.0625,404.3594 662.75,405.4375 Q663.4375,406.5 664.7813,406.5 Q665.4063,406.5 666,406.2344 Q666.5938,405.9531 667.2188,405.375 L667.2188,408.0938 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="684.75" y="406.6074">FujinetCore</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="587.5" x2="820.5" y1="418.4531" y2="418.4531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="587.5" x2="820.5" y1="426.4531" y2="426.4531"/><ellipse cx="597.5" cy="437.4531" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="150" x="606.5" y="440.6636">addTransport(ITransport*)</text><ellipse cx="597.5" cy="450.2578" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="606.5" y="453.4683">ioService(): IOService&amp;</text><ellipse cx="597.5" cy="463.0625" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="209" x="606.5" y="466.2729">deviceManager(): IODeviceManager&amp;</text><ellipse cx="597.5" cy="475.8672" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="206" x="606.5" y="479.0776">routingManager(): RoutingManager&amp;</text><!--MD5=[c62846c0c9715c1d98dd5933e5913037]
class Host--><rect fill="#FEFECE" height="53.9375" id="Host" style="stroke: #A80036; stroke-width: 1.5;" width="254" x="772" y="192.4531"/><ellipse cx="787" cy="211.4219" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M789.9688,217.0625 Q789.3906,217.3594 788.75,217.5 Q788.1094,217.6563 787.4063,217.6563 Q784.9063,217.6563 783.5781,216.0156 Q782.2656,214.3594 782.2656,211.2344 Q782.2656,208.1094 783.5781,206.4531 Q784.9063,204.7969 787.4063,204.7969 Q788.1094,204.7969 788.75,204.9531 Q789.4063,205.1094 789.9688,205.4063 L789.9688,208.125 Q789.3438,207.5469 788.75,207.2813 Q788.1563,207 787.5313,207 Q786.1875,207 785.5,208.0781 Q784.8125,209.1406 784.8125,211.2344 Q784.8125,213.3281 785.5,214.4063 Q786.1875,215.4688 787.5313,215.4688 Q788.1563,215.4688 788.75,215.2031 Q789.3438,214.9219 789.9688,214.3438 L789.9688,217.0625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="53" x="885.5" y="208.5918">HostApp</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="222" x="801" y="222.5605">(POSIX / ESP32 firmware / Emulator)</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="773" x2="1025" y1="230.3906" y2="230.3906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="773" x2="1025" y1="238.3906" y2="238.3906"/><!--MD5=[af8544b34e117dc4e9492815558e5368]
link PtyChannel to Channel--><path d="M1358,498.6831 C1358,530.5131 1358,569.2631 1358,601.2431 " fill="none" id="PtyChannel-&gt;Channel" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="1365,601.6231,1358,621.6231,1351,601.6231,1365,601.6231" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[adba8ad0ae69688ccd1b264c99763601]
link UsbCdcChannel to Channel--><path d="M1714.61,473.9331 C1643.99,511.5531 1533.96,570.1931 1454.8,612.3731 " fill="none" id="UsbCdcChannel-&gt;Channel" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="1458.09,618.5531,1437.14,621.7831,1451.5,606.1931,1458.09,618.5531" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e2457f3af94a50dfeb8d9c6d266f1c36]
link FujiBusTransport to ITransport--><path d="M976.8,505.0631 C976.26,535.7931 975.62,571.8331 975.09,601.8131 " fill="none" id="FujiBusTransport-&gt;ITransport" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="982.09,602.0631,974.74,621.9431,968.09,601.8231,982.09,602.0631" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b107775a37629a43bfa8c1da80dc4005]
link Host to CurrentProfile--><path d="M771.98,227.7831 C614.9,238.5331 357.86,262.1031 273,304.9531 C229.28,327.0331 192.1,370.4031 169.69,400.9631 " fill="none" id="Host-&gt;CurrentProfile" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="166.5,405.3731,175.0223,400.4365,169.4358,401.3258,168.5465,395.7392,166.5,405.3731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="347" y="293.02">calls current_build_profile()</text><!--MD5=[089c98369ce847817abeb3a247d290b6]
link Host to PosixFactory--><path d="M1026.25,219.4531 C1058.24,219.4531 1093.56,219.4531 1128.86,219.4531 " fill="none" id="Host-&gt;PosixFactory" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1134.07,219.4531,1125.07,215.4531,1129.07,219.4531,1125.07,223.4531,1134.07,219.4531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1044.25" y="212.52">POSIX build</text><!--MD5=[6973295f88d99c65d77953b8eab89de8]
link PosixFactory to PtyChannel--><path d="M1358,250.2831 C1358,280.5731 1358,328.5231 1358,367.9631 " fill="none" id="PosixFactory-&gt;PtyChannel" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1358,373.2231,1362,364.2231,1358,368.2231,1354,364.2231,1358,373.2231" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[6fa889fdc94527115d63479b27910620]
link Host to Esp32Factory--><path d="M949.02,192.4531 C992.32,170.7031 1057.34,141.8731 1118,129.9531 C1222.67,109.3931 1492.75,112.6031 1598,129.9531 C1664.05,140.8431 1735.8,166.0931 1787.81,187.0131 " fill="none" id="Host-&gt;Esp32Factory" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1792.46,188.8931,1785.608,181.8185,1787.8226,187.0239,1782.6172,189.2384,1792.46,188.8931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="1294.5" y="115.02">ESP32 build</text><!--MD5=[d78caa44b53b024819f94e73b7e0951b]
link Esp32Factory to UsbCdcChannel--><path d="M1851.15,250.2831 C1838.82,284.1931 1818.44,340.2331 1803.36,381.7031 " fill="none" id="Esp32Factory-&gt;UsbCdcChannel" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1801.64,386.4331,1808.4818,379.3486,1803.3533,381.7358,1800.9661,376.6073,1801.64,386.4331" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[41d92baff049ab6abaddeb981d754a16]
link Host to FujinetCore--><path d="M875.09,246.7531 C844.49,280.4231 790.76,339.5231 751.66,382.5331 " fill="none" id="Host-&gt;FujinetCore" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="748.16,386.3831,757.17,382.4057,751.5198,382.6802,751.2453,377.03,748.16,386.3831" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="843" y="293.02">owns core</text><!--MD5=[85891fb0949cfc191b26f5843307b444]
link FujinetCore to ITransport--><path d="M761.92,485.6531 C808.7,524.9831 874.05,579.9131 919.8,618.3831 " fill="none" id="FujinetCore-&gt;ITransport" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="923.89,621.8231,919.5691,612.9727,920.0606,618.6082,914.4252,619.0997,923.89,621.8231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="840" y="548.02">addTransport()</text><!--MD5=[4e46a679f33b87cb1acfaa612e05e535]
link FujiBusTransport to Channel--><path d="M1077.69,498.0931 C1091.22,506.3131 1104.94,514.6131 1118,522.4531 C1172.44,555.1231 1234.15,591.4931 1281.37,619.1831 " fill="none" id="FujiBusTransport-&gt;Channel" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1285.89,621.8331,1280.1479,613.8313,1281.5763,619.3049,1276.1027,620.7333,1285.89,621.8331" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="1165" y="548.02">uses underlying I/O</text><!--MD5=[72ae9ec6927adab59b5286e38e732ba4]
link Machine to TransportKind--><!--MD5=[bec8232ae9affe6ba4908c1bd6c36ba2]
link Machine to BuildProfile--><!--MD5=[03a7e09dac2e1bc3eed51e044767d619]
@startuml PlatformChannels
title Platform Build Profiles + Channels + Transports

skinparam packageStyle rectangle
skinparam shadowing false

package "fujinet::build" {
    enum Machine {
        Generic
        Atari8Bit
        C64
        ...
    }

    enum TransportKind {
        SerialDebug
        SIO
        IEC
        ...
    }

    class BuildProfile {
        + Machine       machine
        + TransportKind primaryTransport
        + std::string   name
    }

    class "current_build_profile()" as CurrentProfile {
        + BuildProfile current_build_profile()
    }
}

package "fujinet::io::core" {
    interface Channel {
        + available(): bool
        + read(buf, maxLen): std::size_t
        + write(buf, len): void
    }
}

package "fujinet::platform::posix" {
    class PtyChannel {
        - int _masterFd
        - -
        + PtyChannel(int masterFd)
        + ~PtyChannel()
        + available(): bool
        + read(...): std::size_t
        + write(...): void
    }

    class "create_channel_for_profile()" as PosixFactory {
        + std::unique_ptr<Channel> create_channel_for_profile(const BuildProfile&)
    }

    PtyChannel ..|> Channel
}

package "fujinet::platform::esp32" {
    class UsbCdcChannel {
        + UsbCdcChannel()
        + available(): bool
        + read(...): std::size_t
        + write(...): void
    }

    class "create_channel_for_profile()" as Esp32Factory {
        + std::unique_ptr<Channel> create_channel_for_profile(const BuildProfile&)
    }

    UsbCdcChannel ..|> Channel
}

package "fujinet::io::transport" {
    interface ITransport {
        + poll(): void
        + receive(out IORequest): bool
        + send(IOResponse): void
    }

    class FujiBusTransport {
        - Channel& _channel
        - std::vector<uint8_t> _rxBuffer
        - RequestID _nextRequestId
        - -
        + FujiBusTransport(Channel&)
        + poll(): void
        + receive(out IORequest): bool
        + send(IOResponse): void
    }

    FujiBusTransport ..|> ITransport
}

package "fujinet::core" {
    class FujinetCore {
        + addTransport(ITransport*)
        + ioService(): IOService&
        + deviceManager(): IODeviceManager&
        + routingManager(): RoutingManager&
    }
}

class "HostApp\n(POSIX / ESP32 firmware / Emulator)" as Host

Host - -> CurrentProfile : calls current_build_profile()

Host -> PosixFactory : POSIX build
PosixFactory - -> PtyChannel

Host -> Esp32Factory : ESP32 build
Esp32Factory - -> UsbCdcChannel

Host - -> FujinetCore : owns core
FujinetCore - -> ITransport : addTransport()
FujiBusTransport - -> Channel : uses underlying I/O

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.17+10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>