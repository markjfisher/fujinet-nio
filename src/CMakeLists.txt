# This file is automatically generated by scripts/update_cmake_sources.py
# Do not edit this file directly. Edit the template in build-artifacts/ instead.

# This is only used by esp-idf, and not the posix build.

idf_component_register(
    SRCS
    # __TARGET_SOURCES_START__
        app/console_commands.cpp
        app/console_engine.cpp
        app/console_fs_shell.cpp
        app/console_parse.cpp
        app/main_esp32.cpp
        lib/bootstrap.cpp
        lib/build_profile.cpp
        lib/clock_device.cpp
        lib/clock_device_init.cpp
        lib/diagnostic_core_provider.cpp
        lib/diagnostic_disk_provider.cpp
        lib/diagnostic_modem_provider.cpp
        lib/diagnostic_network_provider.cpp
        lib/diagnostic_registry.cpp
        lib/disk/atr_image.cpp
        lib/disk/disk_service.cpp
        lib/disk/image_registry.cpp
        lib/disk/raw_image.cpp
        lib/disk/ssd_image.cpp
        lib/disk_device.cpp
        lib/disk_device_init.cpp
        lib/file_device.cpp
        lib/file_device_init.cpp
        lib/fs_stdio.cpp
        lib/fuji_bus_packet.cpp
        lib/fuji_config_yaml_store.cpp
        lib/fuji_device.cpp
        lib/fujibus_transport.cpp
        lib/fujinet_core.cpp
        lib/fujinet_init.cpp
        lib/io_device_manager.cpp
        lib/io_service.cpp
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/legacy_network_adapter.cpp>
        lib/modem_device.cpp
        lib/modem_device_init.cpp
        lib/network_device.cpp
        lib/network_device_init.cpp
        lib/network_protocol_registry.cpp
        lib/network_protocol_stub.cpp
        lib/routing_manager.cpp
        lib/storage_manager.cpp
        lib/tcp_network_protocol_common.cpp
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/byte_based_legacy_transport.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/iwm_traits.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/iwm_transport.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/legacy_transport.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/netsio_protocol.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/packet_based_legacy_transport.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/sio_traits.cpp>
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:lib/transport/legacy/sio_transport.cpp>
        platform/esp32/channel_factory.cpp
        platform/esp32/console_transport_default.cpp
        platform/esp32/console_transport_uart.cpp
        platform/esp32/console_transport_usbcdc.cpp
        platform/esp32/disk_registry.cpp
        platform/esp32/fs_factory.cpp
        platform/esp32/fs_init.cpp
        platform/esp32/fuji_config_store_factory.cpp
        platform/esp32/fuji_device_factory.cpp
        platform/esp32/hardware_caps.cpp
        platform/esp32/http_network_protocol_espidf.cpp
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:platform/esp32/iwm_bus_hardware.cpp>
        platform/esp32/logging.cpp
        platform/esp32/network_registry.cpp
        platform/esp32/pinmap.cpp
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:platform/esp32/sio_bus_hardware.cpp>
        platform/esp32/sntp_service.cpp
        platform/esp32/tcp_network_protocol_espidf.cpp
        platform/esp32/tcp_socket_ops_default.cpp
        platform/esp32/tcp_socket_ops_espidf.cpp
        platform/esp32/time.cpp
        platform/esp32/tinyusb_cdc.cpp
        platform/esp32/usb_cdc_channel.cpp
        platform/esp32/wifi_link.cpp
# __TARGET_SOURCES_END__
        ../third_party/cjson/cJSON.c
    INCLUDE_DIRS
        "../include"
        "../third_party/cjson"
    REQUIRES
        yaml-cpp-idf
        esp_psram
        esp_wifi
        esp_netif
        nvs_flash
)

# Feature gate for legacy transport support:
# Only enable legacy code paths when building a legacy bus profile (SIO/NetSIO).
#
# ESP-IDF build profiles already define FN_BUILD_ATARI_SIO / FN_BUILD_ATARI_NETSIO at compile time.
target_compile_definitions(${COMPONENT_LIB}
    PUBLIC
        $<$<OR:$<BOOL:${FN_BUILD_ATARI_SIO}>,$<BOOL:${FN_BUILD_ATARI_NETSIO}>>:FN_ENABLE_LEGACY_TRANSPORT>
)

